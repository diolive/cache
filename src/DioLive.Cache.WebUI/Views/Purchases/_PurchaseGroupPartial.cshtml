@model IGrouping<string, PurchaseVM>
@inject IViewLocalizer Localizer
@inject WordLocalizer WordLocalizer

@{
    Word purchasesLocalizer = WordLocalizer.Words[WordLocalizer.Purchases];
    var purchaseGrouping = (int) ViewData["PurchaseGrouping"];
    bool shouldCollapse = purchaseGrouping > 0 && Model.Count() >= purchaseGrouping;

    if (shouldCollapse)
    {
        <tr class="grouping" data-toggle="collapse-next">
            <th>
                <i class="glyphicon glyphicon-chevron-right"></i>
            </th>
            <th>
                @purchasesLocalizer[Model.Count()] (@Model.Key)
            </th>
            <th>
                @string.Format(Constants.CostDisplayFormat, Model.Sum(i => i.Cost))
            </th>
            <th colspan="2">&nbsp;</th>
        </tr>
    }

    ViewData["rowClass"] = shouldCollapse ? "collapse" : null;
    @foreach (PurchaseVM purchase in Model)
    {
        <partial name="_PurchaseDetailsPartial" model="purchase"/>
    }
}